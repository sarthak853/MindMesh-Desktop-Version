<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Keyword Graph - MindMesh</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .graph-container {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        #network {
            width: 100%;
            height: 100%;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 250px;
        }

        .legend h3 {
            font-size: 14px;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .legend-section {
            margin-bottom: 15px;
        }

        .legend-section h4 {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-shape {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .legend-box {
            border-radius: 3px;
        }

        .legend-ellipse {
            border-radius: 50%;
        }

        .legend-diamond {
            transform: rotate(45deg);
            width: 14px;
            height: 14px;
            margin: 3px 13px 3px 3px;
        }

        .legend-dot {
            border-radius: 50%;
            width: 16px;
            height: 16px;
            margin: 2px 12px 2px 2px;
        }

        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            display: none;
        }

        .info-panel.active {
            display: block;
        }

        .info-panel h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .info-panel p {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Hierarchical Keyword Graph</h1>
            <p id="documentName">Loading document...</p>
            <div class="controls">
                <button class="btn btn-primary" onclick="resetView()">Reset View</button>
                <button class="btn btn-primary" onclick="togglePhysics()">Toggle Physics</button>
                <button class="btn btn-secondary" onclick="exportGraph()">Export Graph</button>
                <button class="btn btn-secondary" onclick="window.close()">Close</button>
            </div>
        </div>

        <div class="graph-container">
            <div id="network"></div>
            
            <div class="legend">
                <h3>Legend</h3>
                <div class="legend-section">
                    <h4>Structure</h4>
                    <div class="legend-item">
                        <div class="legend-shape legend-box" style="background: #2c3e50;"></div>
                        <span>Document Overview</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-shape legend-box" style="background: #9b59b6;"></div>
                        <span>Summary</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-shape legend-box" style="background: #e74c3c;"></div>
                        <span>Main Topics</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-shape legend-box" style="background: #1abc9c;"></div>
                        <span>Workflow</span>
                    </div>
                </div>
                <div class="legend-section">
                    <h4>Content</h4>
                    <div class="legend-item">
                        <div class="legend-shape legend-ellipse" style="background: #3498db;"></div>
                        <span>Categories</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-shape legend-diamond" style="background: #f39c12;"></div>
                        <span>Details</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-shape legend-dot" style="background: #2ecc71;"></div>
                        <span>Keywords</span>
                    </div>
                </div>
            </div>

            <div class="info-panel" id="infoPanel">
                <h3 id="infoTitle">Select a node</h3>
                <p id="infoContent">Click on a node to see details</p>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading graph...</p>
            </div>
        </div>
    </div>

    <script>
        let network = null;
        let physicsEnabled = true;

        // Load graph data
        window.addEventListener('DOMContentLoaded', () => {
            loadGraphData();
        });

        function loadGraphData() {
            // This will be populated by the main process
            const graphData = window.graphData || {
                nodes: [],
                edges: []
            };

            if (graphData.nodes.length === 0) {
                document.getElementById('loading').innerHTML = '<p>No graph data available</p>';
                return;
            }

            initializeNetwork(graphData);
            document.getElementById('loading').style.display = 'none';
        }

        function initializeNetwork(data) {
            const container = document.getElementById('network');
            
            const options = {
                nodes: {
                    borderWidth: 2,
                    borderWidthSelected: 4,
                    font: {
                        size: 14,
                        face: 'Segoe UI'
                    }
                },
                edges: {
                    width: 2,
                    color: { color: '#848484', highlight: '#3498db' },
                    smooth: {
                        type: 'continuous'
                    }
                },
                physics: {
                    enabled: true,
                    hierarchicalRepulsion: {
                        centralGravity: 0.0,
                        springLength: 200,
                        springConstant: 0.01,
                        nodeDistance: 150,
                        damping: 0.09
                    },
                    solver: 'hierarchicalRepulsion'
                },
                layout: {
                    hierarchical: {
                        enabled: true,
                        direction: 'UD',
                        sortMethod: 'directed',
                        levelSeparation: 150,
                        nodeSpacing: 200
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 100,
                    zoomView: true,
                    dragView: true
                }
            };

            network = new vis.Network(container, data, options);

            // Event listeners
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    const node = data.nodes.find(n => n.id === nodeId);
                    showNodeInfo(node);
                }
            });

            network.on('hoverNode', function(params) {
                container.style.cursor = 'pointer';
            });

            network.on('blurNode', function(params) {
                container.style.cursor = 'default';
            });
        }

        function showNodeInfo(node) {
            const panel = document.getElementById('infoPanel');
            const title = document.getElementById('infoTitle');
            const content = document.getElementById('infoContent');

            title.textContent = node.label;
            content.innerHTML = node.title || 'No additional information';

            panel.classList.add('active');
        }

        function resetView() {
            if (network) {
                network.fit({
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }

        function togglePhysics() {
            if (network) {
                physicsEnabled = !physicsEnabled;
                network.setOptions({ physics: { enabled: physicsEnabled } });
            }
        }

        function exportGraph() {
            if (network) {
                const canvas = network.canvas.frame.canvas;
                const dataURL = canvas.toDataURL('image/png');
                
                const link = document.createElement('a');
                link.download = 'keyword-graph.png';
                link.href = dataURL;
                link.click();
            }
        }
    </script>
</body>
</html>
